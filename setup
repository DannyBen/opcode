#!/usr/bin/env bash

echo "=== Saving executable to /usr/local/bin/op"
CURL_COMMAND="curl -s https://raw.githubusercontent.com/DannyBen/opcode/master/op > /usr/local/bin/op"
if [[ $EUID -ne 0 ]]; then
  sudo bash -c "$CURL_COMMAND"
  sudo chmod a+x /usr/local/bin/op
else
  bash -c "$CURL_COMMAND"
  chmod a+x /usr/local/bin/op
fi

if type op > /dev/null; then
  if ! grep -m 1 "op --complete" "$HOME/.bashrc" > /dev/null; then
    echo "=== Appending bash completion command to ~/.bashrc"
    printf "\n# Opcode Bash Completion\neval \$(op --complete)\n\n" >> ~/.bashrc
  else
    echo "=== Bash completion is already present in ~/.bashrc"
  fi

  echo "=== Done. Type 'op --help' for more info."
else
  echo "=== Setup failed."
  exit 1
fi
