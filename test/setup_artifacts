#!/usr/bin/env bash
set -e

check_file() {
  file="$1"
  if [[ ! -f "$file" ]]; then
    echo "ERROR: File not found $file"
    exit 1
  fi
}

get_comp_dir() {
  if [[ -d "/usr/share/bash-completion/completions" ]]; then
    echo "/usr/share/bash-completion/completions"
  elif [[ -d "$BASH_COMPLETION" ]]; then
    echo "$BASH_COMPLETION"
  else
    echo ''
  fi
}

# Check that 'op' is in its place
check_file "/usr/local/bin/op"

# Check that we can find the completions dir
compdir="$(get_comp_dir)"
if [[ ! -d "$compdir" ]]; then
  echo "ERROR: Cannot find compdir"
  exit 1
fi

# Check that completions file is in place
check_file "$compdir/op"

echo "Setup artifacts are OK"
